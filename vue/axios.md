# 一套全面又有实际意义的 axios 封装+api 管理方案

## 前言

### 功能点

此文主要是基于 vuecli3 项目中 axios 封装及 api 管理的实践记录及过程中的踩坑收获，功能基本都是根据工作中需求实现。需求背景是，在同一套请求配置下，实现以下主要功能：

-   自定义请求配置
-   设置全局拦截器
-   响应成功及异常的全局拦截统一处理
-   防止重复请求（取消当前重复的请求）
-   路由切换取消当前所有 pending 状态的请求（可配置白名单）
-   单独取消发出的某个请求
-   api 统一管理

## axios 一些特性

在开始之前，首先明确一些 axios 的特性，这些特性会影响到某些功能的实现方式：

-   通过 axios.create()方法创建的实例对象只有常见的数据请求方法，没有取消请求、并发请求等方法。可通过 Object.keys()将所有的 key 打印出来对比得知。
    axios 拦截器是可以累加的，每添加一个拦截器，就会返回一个对应的拦截器 id，也就是无法通过新增拦截的方式覆盖或者改变已有拦截器的配置。但可以利用拦截器 id 通过 axios.interceptors.request.eject(InterceptorId)方法移除指定拦截器。
    对于同一个 axios 对象，如果全局拦截器中设置了 CancelToken 属性，就无法在单独的请求中再通过此属性取消请求。移除全局拦截器可以解决这个问题，但又会有另一个问题，拦截器移除后就永远失效了，影响是全局的。
    axios 中以别名的形式（axios.get、axios.post)发请求，不同的请求方式参数的写法是不一样的，主要是 put/post/patch 三种方法与其他不太一样
    自定义请求配置
    根目录下新建 plugins/axios/index.js 文件，自定义 axios 的请求配置。

这里 process.env.VUE_APP_BASEURL 是一个定义好的变量，值为"/webapi";

设置超时时间 timeout 为 10s。如下：
