# ubuntu

liw: AE.9

set ubuntu environment online. 

setting static ip address：

```sudo vi /etc/netplan/50-cloud-init.yaml```

```yaml
# This file is generated from information provided by the datasource.  Changes
# to it will not persist across an instance reboot.  To disable cloud-init's
# network configuration capabilities, write a file
# /etc/cloud/cloud.cfg.d/99-disable-network-config.cfg with the following:
# network: {config: disabled}
network:
    ethernets:
        eno1:
            dhcp4: no
            addresses:
              - 192.168.1.250/24
            routes:
              - to: default
                via: 192.168.1.1
            nameservers:
              addresses: [8.8.8.8, 8.8.4.4]
    version: 2
```

## mysql

```bash
sudo apt update
sudo apt install mysql-server -y
mysql --version
# mysql  Ver 8.0.40-0ubuntu0.24.04.1 for Linux on x86_64 ((Ubuntu))

sudo systemctl enable mysql
sudo systemctl start mysql
sudo systemctl status mysql
```

root: MDd+e.9
blog: B..9
house:H..9


## ddclient

```sudo apt install ddlceint```

to setting:

```sudo cat /etc/ddclient.conf```

```conf
# Configuration file for ddclient generated by debconf
#
# /etc/ddclient.conf

protocol=cloudflare, \
use=web, web=ipify-ipv4, \
zone=emacsvi.com, \
password='SwA60gfM8u8aX7taGlyeHuOKhPe9un_1ckr-Pi8Z' \
emacsvi.com,wp.emacsvi.com,www.emacsvi.com
```

## timezone

set Australia timezone

```bash
timedatectl list-timezones | grep Australia
# Australia/Melbourne
sudo timedatectl set-timezone Australia/Melbourne
```

## panel

错误原因：当前面板已开启域名访问，请输入您设置的域名访问面板，如您没记录或不记得了，可以使用以下方式解决

解决方法：在SSH终端输入以下一种命令来解决

1.如果您忘记了正确的绑定域名，请登录SSH，执行命令查看绑定信息：bt default

2.如果您的域名已弃用，请登录SSH，执行bt 12，取消域名绑定

## find big file

```bash
find . -type f -size +800M  -print0 | xargs -0 du -h | sort -nr
```

## delete lock file

```bash
chattr -i .user.ini 
```

## TIME-WAIT

```bash
ss -an |awk '{print $2}'|sort |uniq -dc |sort -rn
```

## as server

[ulimit files](https://www.linkedin.com/pulse/some-simple-things-tuning-your-ubuntu-server-yen-thanh-le/)

1. Add those lines to file /etc/security/limits.conf
   ```
   *    soft nofile 1048576
   *    hard nofile 1048576
   root soft nofile 1048576
   root hard nofile 1048576
   ```
2. Add this line to file /etc/pam.d/common-session
   ```
   session required pam_limits.so
   ```
3. Add more lines to file /etc/sysctl.conf
   ```
   fs.file-max = 2097152
   fs.nr_open = 1048576
   ```
4. Your server is limited the maximum number of connections?
   This may happens with some kind of server, we need to increase this value to make the server accepts more number of connections. It’s pretty simple. Just open file /etc/sysctl.conf and add below lines, then reboot:

   ```
   net.ipv4.netfilter.ip_conntrack_max = 1048576
   net.nf_conntrack_max = 1048576
   net.core.somaxconn = 1048576
   ```

## permit

要在Linux命令中增加读写权限，可以使用chmod命令。chmod命令用于改变文件或目录的访问权限。下面是一些常用的chmod命令选项和用法：

1. 基本用法：
   chmod [选项] 模式 文件/目录

2. 模式：
   权限模式可以用数字表示或符号表示。

   数字表示权限模式，每个数字表示一个权限分组。权限分组包括所有者、所属组和其他用户。
   – r（读取权限）：表示值为4，可读取文件
   – w（写入权限）：表示值为2，可编辑/写入文件
   – x（执行权限）：表示值为1，可执行文件/访问目录

   例如，如果要将文件的所有者权限设置为读取、写入和执行权限（即777权限），可以使用以下命令：
   chmod 777 文件名

3. 符号表示权限模式，使用一些符号来表示不同的权限。
   – + 表示添加权限
   – – 表示删除权限
   – = 表示设置权限为指定值

   例如，如果要将文件的所有者权限设置为读取、写入和执行权限，可以使用以下命令：
   chmod u+rwx 文件名

4. 选项：
   -R 递归修改文件和子目录的权限

   例如，如果要将一个目录及其子目录中的所有文件的权限都设置为可读写，可以使用以下命令：
   chmod -R u+rw 目录名

   注意：使用-R选项时要小心，以免意外修改了不应修改的文件。

补充说明：还有一种常用的方式是通过u、g、o来表示权限分组。u表示文件的所有者，g表示文件的所属组，o表示其他用户。如果要对多个权限分组添加或删除权限，可以使用逗号分隔。例如，要将文件的所有者和所属组的读、写权限都设置为可执行权限，可以使用以下命令：
chmod u+rx,g+rx 文件名

综上所述，以上是在Linux命令中增加读写权限的一些常见做法。具体的使用方式可以根据实际情况进行调整。

## golang

[golang download](https://go.dev/doc/install)

```bash
sudo rm -rf /usr/local/go 
sudo tar -C /usr/local -xzf go1.23.5.linux-amd64.tar.gz
# export PATH=$PATH:/usr/local/go/bin
echo "export PATH=$PATH:/usr/local/go/bin" >> ~/.profile
echo "export GOPATH=~/.go" >> ~/.profile
source ~/.profile
```

## prometheus

[prometheus install by ubuntu os](https://www.cherryservers.com/blog/install-prometheus-ubuntu)

```bash
sudo groupadd --system prometheus
sudo useradd -s /sbin/nologin --system -g prometheus prometheus
sudo mkdir /etc/prometheus
sudo mkdir /var/lib/prometheus


sudo mv prometheus /usr/local/bin
sudo mv promtool /usr/local/bin
sudo chown prometheus:prometheus /usr/local/bin/prometheus
sudo chown prometheus:prometheus /usr/local/bin/promtool

# maybe not consoles and console_libraries in the fold but it doesn't matter
sudo mv consoles /etc/prometheus
sudo mv console_libraries /etc/prometheus
sudo mv prometheus.yml /etc/prometheus

sudo chown prometheus:prometheus /etc/prometheus
sudo chown -R prometheus:prometheus /etc/prometheus/consoles
sudo chown -R prometheus:prometheus /etc/prometheus/console_libraries
sudo chown -R prometheus:prometheus /var/lib/prometheus

sudo nano /etc/systemd/system/prometheus.service
sudo systemctl daemon-reload
sudo systemctl enable prometheus
sudo systemctl start prometheus
sudo systemctl status prometheus

sudo ufw allow 9090/tcp
# With Prometheus running successfully, you can access it via your web browser using http://localhost:9090 or <ip_address>:9090
```

setting auth 

[basic auth](https://prometheus.io/docs/guides/basic-auth/)

prometheus.service

```service
[Unit]
Description=Prometheus
Wants=network-online.target
After=network-online.target

[Service]
User=prometheus
Group=prometheus
Type=simple
ExecStart=/usr/local/bin/prometheus \
    --config.file /etc/prometheus/prometheus.yml \
    --storage.tsdb.path /var/lib/prometheus/ \
    --web.config.file /etc/prometheus/web.yml \
    --web.console.templates=/etc/prometheus/consoles \
    --web.console.libraries=/etc/prometheus/console_libraries

[Install]
WantedBy=multi-user.target
```

## node_exporter

[node_exporter service](https://gist.github.com/nwesterhausen/d06a772cbf2a741332e37b5b19edb192)

use the prometheus use and group to run

```bash
tar -zxvf node_exporter-1.8.2.linux-amd64.tar.gz
cd node_exporter-1.8.2.linux-amd64/
sudo mv node_exporter /usr/local/bin/
sudo chown prometheus:prometheus /usr/local/bin/node_exporter
node_exporter.service
sudo cp node_exporter.service /etc/systemd/system/
sudo systemctl daemon-reload
sudo systemctl enable node_exporter.service
sudo systemctl start node_exporter.service
sudo systemctl status node_exporter.service
sudo journalctl -f --unit node_exporter
```

```service
[Unit]
Description=Node Exporter
Wants=network-online.target
After=network-online.target

[Service]
User=prometheus
Group=prometheus
Type=simple
ExecStart=/usr/local/bin/node_exporter --collector.systemd

[Install]
WantedBy=multi-user.target
```

and then add the job to prometheus.yml

```yml
  - job_name: "node"

    # metrics_path defaults to '/metrics'
    # scheme defaults to 'http'.

    static_configs:
      - targets: ["localhost:9100"]
```

and then to reload prometheus


```sudo kill -HUP  pid_of_prometheus```

## grafana


## mysqld_exporter